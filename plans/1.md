# Implementation Plan: team-dynamics-ranker

## Overview

This plan describes the implementation of a `vector.function` that ranks founder groups by their team composition and dynamics. The function evaluates multiple dimensions of team health and returns a probability distribution where higher scores indicate healthier team dynamics.

---

## 1. Input Schema Structure

### Top-Level Schema
```json
{
  "type": "object",
  "description": "Input for ranking founder groups by team composition and dynamics",
  "properties": {
    "items": {
      "type": "array",
      "description": "Array of founder groups to rank. Each group is an array of founder objects representing a founding team.",
      "minItems": 2,
      "items": {
        "type": "array",
        "description": "A founder group (founding team) containing one or more founder objects",
        "minItems": 1,
        "items": { "$ref": "#/$defs/founder" }
      }
    }
  },
  "required": ["items"],
  "$defs": {
    "founder": { ... }
  }
}
```

### Founder Object Schema
Each founder object contains:

**Required Fields:**
| Field | Type | Description |
|-------|------|-------------|
| `name` | string | Founder's name (identity anchor) |
| `role` | string | Declared role (CEO, CTO, COO, Co-founder, etc.) |
| `percent_equity` | integer | Ownership stake (0-100) |
| `technical_founder` | boolean | Whether founder has technical/engineering capability |
| `in_school` | boolean | Whether founder is currently a student |
| `commit_exclusively` | boolean | Whether founder is committed full-time to venture |

**Optional Fields:**
| Field | Type | Description |
|-------|------|-------------|
| `age` | integer | Founder's age |
| `gender` | string | Founder's gender |
| `city` | string | Current city of residence |
| `education` | array of objects | Educational background (institution, degree, field, graduation_year) |
| `work_history` | array of objects | Work experience (company, title, start_year, end_year) |
| `hacked_system` | string | Description of creative problem-solving |
| `impressive_thing` | string | Most impressive prior achievement |
| `built_things` | string | Description of things they've built |
| `accolades` | string | Awards, recognition, external validation |

---

## 2. Input Maps

One input map is needed to iterate over founder groups:

```json
"input_maps": [
  {
    "$starlark": "input['items']"
  }
]
```

This creates `map` index 0 containing the array of founder groups. Each task will iterate over this map, with each iteration receiving one founder group (array of founder objects).

---

## 3. Function Definition Structure

```json
{
  "type": "vector.function",
  "description": "Rank founder groups by team composition and dynamics. Returns a probability distribution where higher values indicate healthier team dynamics. Evaluates commitment alignment, skill complementarity, equity health, prior relationships, geographic considerations, and team size across 14 dimensions.",
  "input_schema": { ... },
  "input_maps": [ ... ],
  "tasks": [ ... ],  // 14 tasks
  "output_length": {
    "$starlark": "len(input['items'])"
  },
  "input_split": {
    "$starlark": "[{'items': [item]} for item in input['items']]"
  },
  "input_merge": {
    "$starlark": "{'items': [sub['items'][0] for sub in input]}"
  }
}
```

---

## 4. Tasks (14 Total)

Each task is a `vector.completion` with:
- `map`: 0 (references the founder groups array)
- `messages`: system prompt + user content with founder group data
- `responses`: binary LOW/HIGH options
- `output`: normalization expression

### Task List

| # | Name | Dimension | Focus |
|---|------|-----------|-------|
| 1 | Exclusive Commitment Alignment | Commitment | All `commit_exclusively: true` |
| 2 | School Status Alignment | Commitment | Consistent `in_school` status |
| 3 | Technical Founder Presence | Skills | At least one `technical_founder: true` |
| 4 | Builder-Seller Differentiation | Skills | Technical + business balance |
| 5 | Role Clarity | Skills | Distinct, non-overlapping roles |
| 6 | Equity Distribution Fairness | Equity | Healthy splits, no single-digit stakes |
| 7 | Equity-Role Coherence | Equity | Stakes match roles |
| 8 | Prior Working Relationships | Relationships | Overlapping work history |
| 9 | Geographic Co-location | Geography | Same city |
| 10 | Startup Ecosystem Access | Geography | Major hub location |
| 11 | Team Size Appropriateness | Structure | 2-3 founders ideal |
| 12 | Background Diversity | Skills | Cognitive diversity signals |
| 13 | Execution Evidence | Capability | `built_things`, `impressive_thing` |
| 14 | Holistic Team Health | Integration | Overall assessment |

---

## 5. Expressions to Write

### 5.1 User Content Expression (for each task)

Format founder group as readable text for LLM evaluation:

```starlark
[{'type': 'text', 'text': '\\n'.join(['FOUNDER GROUP:', ''] + ['Founder ' + str(i+1) + ':', '  Name: ' + f.get('name', 'N/A'), '  Role: ' + f.get('role', 'N/A'), '  Equity: ' + str(f.get('percent_equity', 'N/A')) + '%', '  Technical: ' + str(f.get('technical_founder', 'N/A')), '  In School: ' + str(f.get('in_school', 'N/A')), '  Commits Exclusively: ' + str(f.get('commit_exclusively', 'N/A')), '  Age: ' + str(f.get('age', 'N/A')), '  Gender: ' + str(f.get('gender', 'N/A')), '  City: ' + str(f.get('city', 'N/A')), '  Education: ' + str(f.get('education', [])), '  Work History: ' + str(f.get('work_history', [])), '  Built Things: ' + str(f.get('built_things', 'N/A')), '  Impressive Thing: ' + str(f.get('impressive_thing', 'N/A')), '  Hacked System: ' + str(f.get('hacked_system', 'N/A')), '  Accolades: ' + str(f.get('accolades', 'N/A')), ''] for i, f in enumerate(map)])}]
```

Simplified alternative (more readable):
```starlark
[{'type': 'text', 'text': 'FOUNDER GROUP:\\n\\n' + '\\n\\n'.join(['Founder ' + str(i+1) + ':\\n' + '\\n'.join(['  ' + k + ': ' + str(v) for k, v in f.items()]) for i, f in enumerate(map)])}]
```

### 5.2 Output Normalization Expression

For each task, normalize scores to probability distribution:

```starlark
(lambda scores: [s / sum(scores) if sum(scores) > 0 else 1.0 / len(scores) for s in scores])([o['scores'][1] for o in output])
```

This:
- Extracts the HIGH score (index 1) from each completion
- Normalizes to sum to 1.0
- Handles edge case of all-zero scores

### 5.3 Output Length Expression

```starlark
len(input['items'])
```

### 5.4 Input Split Expression

```starlark
[{'items': [item]} for item in input['items']]
```

### 5.5 Input Merge Expression

```starlark
{'items': [sub['items'][0] for sub in input]}
```

---

## 6. Test Inputs

### Test Case 1: Classic Strong Team vs Weak Team
Two founder groups comparing ideal composition against problematic one.

```json
{
  "items": [
    [
      {
        "name": "Alice Chen",
        "role": "CEO",
        "percent_equity": 50,
        "technical_founder": false,
        "in_school": false,
        "commit_exclusively": true,
        "age": 32,
        "gender": "Female",
        "city": "San Francisco",
        "education": [{"institution": "Stanford GSB", "degree": "MBA", "field": "Business", "graduation_year": 2018}],
        "work_history": [{"company": "Stripe", "title": "Product Manager", "start_year": 2018, "end_year": 2023}],
        "built_things": "Led launch of Stripe Atlas expansion to 12 new countries",
        "impressive_thing": "Grew Stripe Atlas from $10M to $50M ARR"
      },
      {
        "name": "Bob Park",
        "role": "CTO",
        "percent_equity": 50,
        "technical_founder": true,
        "in_school": false,
        "commit_exclusively": true,
        "age": 30,
        "gender": "Male",
        "city": "San Francisco",
        "education": [{"institution": "MIT", "degree": "BS", "field": "Computer Science", "graduation_year": 2016}],
        "work_history": [{"company": "Stripe", "title": "Senior Engineer", "start_year": 2016, "end_year": 2023}],
        "built_things": "Built Stripe's fraud detection ML system from scratch",
        "impressive_thing": "System processes $100B+ annually with 99.99% uptime"
      }
    ],
    [
      {
        "name": "Charlie Davis",
        "role": "CEO",
        "percent_equity": 85,
        "technical_founder": false,
        "in_school": false,
        "commit_exclusively": true,
        "age": 45,
        "gender": "Male",
        "city": "Chicago"
      },
      {
        "name": "Diana Evans",
        "role": "CTO",
        "percent_equity": 10,
        "technical_founder": true,
        "in_school": true,
        "commit_exclusively": false,
        "age": 22,
        "gender": "Female",
        "city": "Boston"
      },
      {
        "name": "Eric Foster",
        "role": "COO",
        "percent_equity": 5,
        "technical_founder": false,
        "in_school": false,
        "commit_exclusively": false,
        "age": 28,
        "gender": "Male",
        "city": "Austin"
      }
    ]
  ]
}
```

**Expected Outcome**: First team should rank significantly higher (co-located, equal equity, prior work relationship at Stripe, both committed, complementary skills).

### Test Case 2: Solo Founder Comparison
Comparing solo founders with different backgrounds.

```json
{
  "items": [
    [
      {
        "name": "Grace Kim",
        "role": "Founder & CEO",
        "percent_equity": 100,
        "technical_founder": true,
        "in_school": false,
        "commit_exclusively": true,
        "age": 35,
        "city": "New York",
        "work_history": [
          {"company": "Google", "title": "Staff Engineer", "start_year": 2015, "end_year": 2020},
          {"company": "Datadog", "title": "Engineering Director", "start_year": 2020, "end_year": 2024}
        ],
        "built_things": "Led team that built Datadog's APM product",
        "impressive_thing": "Took product from 0 to $100M ARR"
      }
    ],
    [
      {
        "name": "Henry Lopez",
        "role": "Founder",
        "percent_equity": 100,
        "technical_founder": false,
        "in_school": true,
        "commit_exclusively": false,
        "age": 21,
        "city": "Columbus, OH"
      }
    ]
  ]
}
```

**Expected Outcome**: First solo founder should rank higher (exceptional background, committed, ecosystem access).

### Test Case 3: Mixed Commitment Patterns
Three teams with varying commitment patterns.

```json
{
  "items": [
    [
      {"name": "A1", "role": "CEO", "percent_equity": 50, "technical_founder": false, "in_school": false, "commit_exclusively": true},
      {"name": "A2", "role": "CTO", "percent_equity": 50, "technical_founder": true, "in_school": false, "commit_exclusively": true}
    ],
    [
      {"name": "B1", "role": "CEO", "percent_equity": 50, "technical_founder": false, "in_school": true, "commit_exclusively": true},
      {"name": "B2", "role": "CTO", "percent_equity": 50, "technical_founder": true, "in_school": true, "commit_exclusively": true}
    ],
    [
      {"name": "C1", "role": "CEO", "percent_equity": 50, "technical_founder": false, "in_school": false, "commit_exclusively": true},
      {"name": "C2", "role": "CTO", "percent_equity": 50, "technical_founder": true, "in_school": true, "commit_exclusively": false}
    ]
  ]
}
```

**Expected Outcome**: Team A > Team B > Team C (A has full commitment, B has aligned school status, C has misaligned commitment).

### Test Case 4: Large Team Anti-Pattern
Comparing properly-sized teams against bloated founding team.

```json
{
  "items": [
    [
      {"name": "X1", "role": "CEO", "percent_equity": 34, "technical_founder": false, "in_school": false, "commit_exclusively": true, "city": "SF"},
      {"name": "X2", "role": "CTO", "percent_equity": 33, "technical_founder": true, "in_school": false, "commit_exclusively": true, "city": "SF"},
      {"name": "X3", "role": "CPO", "percent_equity": 33, "technical_founder": true, "in_school": false, "commit_exclusively": true, "city": "SF"}
    ],
    [
      {"name": "Y1", "role": "Co-founder", "percent_equity": 17, "technical_founder": true, "in_school": false, "commit_exclusively": true},
      {"name": "Y2", "role": "Co-founder", "percent_equity": 17, "technical_founder": true, "in_school": false, "commit_exclusively": true},
      {"name": "Y3", "role": "Co-founder", "percent_equity": 17, "technical_founder": false, "in_school": false, "commit_exclusively": true},
      {"name": "Y4", "role": "Co-founder", "percent_equity": 17, "technical_founder": false, "in_school": false, "commit_exclusively": true},
      {"name": "Y5", "role": "Co-founder", "percent_equity": 16, "technical_founder": false, "in_school": false, "commit_exclusively": true},
      {"name": "Y6", "role": "Co-founder", "percent_equity": 16, "technical_founder": false, "in_school": false, "commit_exclusively": true}
    ]
  ]
}
```

**Expected Outcome**: Team X should rank higher (right-sized, clear roles, co-located vs too many founders with vague roles).

### Test Case 5: No Technical Founder Red Flag
Testing detection of missing technical capability.

```json
{
  "items": [
    [
      {"name": "P1", "role": "CEO", "percent_equity": 60, "technical_founder": true, "in_school": false, "commit_exclusively": true},
      {"name": "P2", "role": "COO", "percent_equity": 40, "technical_founder": false, "in_school": false, "commit_exclusively": true}
    ],
    [
      {"name": "Q1", "role": "CEO", "percent_equity": 50, "technical_founder": false, "in_school": false, "commit_exclusively": true},
      {"name": "Q2", "role": "CFO", "percent_equity": 50, "technical_founder": false, "in_school": false, "commit_exclusively": true}
    ]
  ]
}
```

**Expected Outcome**: Team P should rank significantly higher (has technical founder vs no technical capability).

### Test Case 6: Prior Relationship Signal
Testing detection of overlapping work history.

```json
{
  "items": [
    [
      {
        "name": "R1", "role": "CEO", "percent_equity": 50, "technical_founder": false, "in_school": false, "commit_exclusively": true,
        "work_history": [{"company": "Airbnb", "title": "PM", "start_year": 2018, "end_year": 2022}]
      },
      {
        "name": "R2", "role": "CTO", "percent_equity": 50, "technical_founder": true, "in_school": false, "commit_exclusively": true,
        "work_history": [{"company": "Airbnb", "title": "Engineer", "start_year": 2017, "end_year": 2022}]
      }
    ],
    [
      {
        "name": "S1", "role": "CEO", "percent_equity": 50, "technical_founder": false, "in_school": false, "commit_exclusively": true,
        "work_history": [{"company": "Goldman Sachs", "title": "Analyst", "start_year": 2018, "end_year": 2022}]
      },
      {
        "name": "S2", "role": "CTO", "percent_equity": 50, "technical_founder": true, "in_school": false, "commit_exclusively": true,
        "work_history": [{"company": "Facebook", "title": "Engineer", "start_year": 2017, "end_year": 2022}]
      }
    ]
  ]
}
```

**Expected Outcome**: Team R should rank higher (prior working relationship at Airbnb).

---

## 7. Implementation Notes

### Message Content Formatting

Since founder groups are structured data (arrays of objects), we need to serialize them to readable text for LLM evaluation. The user content expression should produce a clean, formatted representation like:

```
FOUNDER GROUP:

Founder 1:
  Name: Alice Chen
  Role: CEO
  Equity: 50%
  Technical: False
  In School: False
  Commits Exclusively: True
  City: San Francisco
  ...

Founder 2:
  Name: Bob Park
  Role: CTO
  ...
```

### Binary Response Design

Each task uses binary LOW/HIGH responses where:
- Index 0 = LOW (concerning signal)
- Index 1 = HIGH (healthy signal)

The output expression extracts `scores[1]` (the HIGH probability) for normalization.

### Aggregation Strategy

All 14 tasks contribute equally to the final ranking. The normalized outputs from each task are implicitly aggregated by the vector function framework to produce the final probability distribution.

---

## 8. Files to Create

1. `function.json` - Complete function definition
2. `tests/test_strong_vs_weak.json` - Test case 1
3. `tests/test_solo_founders.json` - Test case 2
4. `tests/test_commitment_patterns.json` - Test case 3
5. `tests/test_team_size.json` - Test case 4
6. `tests/test_technical_founder.json` - Test case 5
7. `tests/test_prior_relationship.json` - Test case 6

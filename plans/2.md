# Implementation Plan: team-dynamics-ranker

## Overview

The **team-dynamics-ranker** is a `vector.function` that ranks founder groups by their team dynamics, composition, and complementarity. It accepts an array of founder groups (each group being an array of founder objects) and returns a probability distribution indicating relative team quality.

---

## Input Schema Structure

```json
{
  "type": "object",
  "description": "Input for ranking founder groups by team dynamics and composition quality",
  "properties": {
    "items": {
      "type": "array",
      "description": "Array of founder groups to rank. Each group is an array of founder objects representing a founding team.",
      "minItems": 2,
      "items": {
        "type": "array",
        "description": "A founder group (founding team) consisting of one or more founders",
        "minItems": 1,
        "items": {
          "type": "object",
          "description": "A founder with biographical and role information",
          "properties": {
            "name": {
              "type": "string",
              "description": "Full name of the founder"
            },
            "role": {
              "type": "string",
              "description": "Role/title in the startup (e.g., CEO, CTO, COO, Co-Founder)"
            },
            "percent_equity": {
              "type": "integer",
              "description": "Percentage of equity owned by this founder (0-100)"
            },
            "technical_founder": {
              "type": "boolean",
              "description": "Whether this founder has technical capability to build the product"
            },
            "in_school": {
              "type": "boolean",
              "description": "Whether this founder is currently a student"
            },
            "commit_exclusively": {
              "type": "boolean",
              "description": "Whether this founder will work on this startup exclusively (full-time)"
            },
            "age": {
              "type": "integer",
              "description": "Age of the founder in years"
            },
            "gender": {
              "type": "string",
              "description": "Gender of the founder"
            },
            "city": {
              "type": "string",
              "description": "City where the founder is based"
            },
            "education": {
              "type": "array",
              "description": "Educational background of the founder",
              "items": {
                "type": "object",
                "properties": {
                  "institution": {
                    "type": "string",
                    "description": "Name of the educational institution"
                  },
                  "degree": {
                    "type": "string",
                    "description": "Type of degree (e.g., BS, MS, MBA, PhD)"
                  },
                  "field": {
                    "type": "string",
                    "description": "Field of study"
                  },
                  "year": {
                    "type": "integer",
                    "description": "Graduation year"
                  }
                }
              }
            },
            "work_history": {
              "type": "array",
              "description": "Professional work history of the founder",
              "items": {
                "type": "object",
                "properties": {
                  "company": {
                    "type": "string",
                    "description": "Name of the company"
                  },
                  "title": {
                    "type": "string",
                    "description": "Job title held"
                  },
                  "start_year": {
                    "type": "integer",
                    "description": "Year the position started"
                  },
                  "end_year": {
                    "type": "integer",
                    "description": "Year the position ended (or current year if still there)"
                  },
                  "description": {
                    "type": "string",
                    "description": "Description of responsibilities and accomplishments"
                  }
                }
              }
            },
            "hacked_system": {
              "type": "string",
              "description": "Description of a system or process the founder creatively circumvented or exploited"
            },
            "impressive_thing": {
              "type": "string",
              "description": "The most impressive thing this founder has accomplished"
            },
            "built_things": {
              "type": "string",
              "description": "Products, projects, or companies the founder has built"
            },
            "accolades": {
              "type": "string",
              "description": "Awards, recognition, or notable achievements"
            }
          },
          "required": ["name", "role", "percent_equity", "technical_founder", "in_school", "commit_exclusively"]
        }
      }
    }
  },
  "required": ["items"]
}
```

---

## Input Maps

The function needs one input map to iterate over founder groups:

```json
"input_maps": [
  {
    "$starlark": "input['items']"
  }
]
```

This creates `map` index 0 which iterates over each founder group (team) in the items array.

---

## Function Definition Structure

```json
{
  "type": "vector.function",
  "description": "Rank founder groups by team dynamics, composition, and complementarity. Returns a probability distribution over teams with higher scores indicating stronger team composition. Evaluates role clarity, skill complementarity, equity alignment, commitment levels, leadership structure, and diversity across 16 dimensions.",
  "input_schema": { ... },
  "input_maps": [
    { "$starlark": "input['items']" }
  ],
  "tasks": [ ... 16 tasks ... ],
  "output_length": {
    "$starlark": "len(input['items'])"
  },
  "input_split": {
    "$starlark": "[{'items': [item]} for item in input['items']]"
  },
  "input_merge": {
    "$starlark": "{'items': [sub['items'][0] for sub in input]}"
  }
}
```

---

## Expressions to Write

### 1. User Content Expression (for each task)

Each task needs to convert the founder group (array of founder objects) into a text representation for the LLM to evaluate:

```starlark
[{'type': 'text', 'text': '\\n'.join(['Founder ' + str(i+1) + ':\\n  Name: ' + f['name'] + '\\n  Role: ' + f['role'] + '\\n  Equity: ' + str(f['percent_equity']) + '%\\n  Technical: ' + str(f['technical_founder']) + '\\n  Commits Exclusively: ' + str(f['commit_exclusively']) + '\\n  In School: ' + str(f['in_school']) + ('\\n  Age: ' + str(f['age']) if 'age' in f else '') + ('\\n  Gender: ' + f['gender'] if 'gender' in f else '') + ('\\n  City: ' + f['city'] if 'city' in f else '') + ('\\n  Education: ' + ', '.join([e['degree'] + ' in ' + e['field'] + ' from ' + e['institution'] + ' (' + str(e['year']) + ')' for e in f['education']]) if 'education' in f and f['education'] else '') + ('\\n  Work History: ' + ', '.join([w['title'] + ' at ' + w['company'] + ' (' + str(w['start_year']) + '-' + str(w['end_year']) + ')' for w in f['work_history']]) if 'work_history' in f and f['work_history'] else '') + ('\\n  Hacked System: ' + f['hacked_system'] if 'hacked_system' in f else '') + ('\\n  Impressive Thing: ' + f['impressive_thing'] if 'impressive_thing' in f else '') + ('\\n  Built Things: ' + f['built_things'] if 'built_things' in f else '') + ('\\n  Accolades: ' + f['accolades'] if 'accolades' in f else '') for i, f in enumerate(map)])}]
```

**Simplified version** (more readable, may need adjustment):

```starlark
[{'type': 'text', 'text': 'FOUNDER GROUP:\\n\\n' + '\\n\\n'.join(['Founder: ' + f['name'] + '\\nRole: ' + f['role'] + '\\nEquity: ' + str(f['percent_equity']) + '%\\nTechnical Founder: ' + str(f['technical_founder']) + '\\nCommits Exclusively: ' + str(f['commit_exclusively']) + '\\nIn School: ' + str(f['in_school']) + (('\\nAge: ' + str(f.get('age', ''))) if f.get('age') else '') + (('\\nGender: ' + f.get('gender', '')) if f.get('gender') else '') + (('\\nCity: ' + f.get('city', '')) if f.get('city') else '') + (('\\nEducation:\\n' + '\\n'.join(['  - ' + e.get('degree', '') + ' in ' + e.get('field', '') + ' from ' + e.get('institution', '') + ' (' + str(e.get('year', '')) + ')' for e in f.get('education', [])])) if f.get('education') else '') + (('\\nWork History:\\n' + '\\n'.join(['  - ' + w.get('title', '') + ' at ' + w.get('company', '') + ' (' + str(w.get('start_year', '')) + '-' + str(w.get('end_year', '')) + ')' + (': ' + w.get('description', '') if w.get('description') else '') for w in f.get('work_history', [])])) if f.get('work_history') else '') + (('\\nHacked System: ' + f.get('hacked_system', '')) if f.get('hacked_system') else '') + (('\\nImpressive Thing: ' + f.get('impressive_thing', '')) if f.get('impressive_thing') else '') + (('\\nBuilt Things: ' + f.get('built_things', '')) if f.get('built_things') else '') + (('\\nAcocolades: ' + f.get('accolades', '')) if f.get('accolades') else '') for f in map])}]
```

### 2. Output Expression (for each task)

Standard normalization to create probability distribution, favoring HIGH (index 1):

```starlark
(lambda scores: [s / sum(scores) if sum(scores) > 0 else 1.0 / len(scores) for s in scores])([o['scores'][1] for o in output])
```

### 3. Output Length Expression

```starlark
len(input['items'])
```

### 4. Input Split Expression

```starlark
[{'items': [item]} for item in input['items']]
```

### 5. Input Merge Expression

```starlark
{'items': [sub['items'][0] for sub in input]}
```

---

## Tasks (16 Total)

Each task follows this structure:
- `type`: "vector.completion"
- `map`: 0 (references the input_maps[0] which iterates over founder groups)
- `messages`: system prompt defining the evaluation, user content with founder group data
- `responses`: LOW and HIGH options
- `output`: normalization expression

### Task List:

1. **Role Distinctness and Non-Overlap** - Evaluate whether each founder has a distinct, clearly-defined role
2. **Technical Capability Presence** - Assess whether at least one founder can build the product
3. **Commercial Capability Presence** - Assess whether at least one founder can sell/raise capital
4. **Technical-Commercial Complementarity** - Evaluate the balance between technical and business skills
5. **Equity Distribution Alignment** - Assess whether equity reflects role and contribution appropriately
6. **Equity-Commitment Alignment** - Evaluate whether equity matches commitment levels
7. **Leadership Clarity** - Assess whether there's a clear decision-maker (CEO)
8. **Leader Credibility** - Evaluate whether the CEO has appropriate background
9. **Educational Diversity** - Assess diversity in educational backgrounds
10. **Professional Experience Diversity** - Evaluate diversity in work history
11. **Commitment Level Assessment** - Assess overall team commitment
12. **Team Size Appropriateness** - Evaluate whether team size is appropriate
13. **Exceptional Founder Signals** - Assess presence of hacked_system, impressive_thing, built_things, accolades
14. **Founder-Background Consistency** - Evaluate whether roles match demonstrated expertise
15. **Geographic and Demographic Diversity** - Assess diversity across demographic dimensions
16. **Holistic Team Composition Assessment** - Overall synthesis across all dimensions

---

## Test Inputs

### Test 1: Ideal Team (Baseline - Strong on all dimensions)
```json
{
  "items": [
    [
      {
        "name": "Sarah Chen",
        "role": "CEO",
        "percent_equity": 45,
        "technical_founder": false,
        "in_school": false,
        "commit_exclusively": true,
        "age": 34,
        "gender": "Female",
        "city": "San Francisco",
        "education": [
          {"institution": "Stanford University", "degree": "MBA", "field": "Business Administration", "year": 2018},
          {"institution": "UC Berkeley", "degree": "BA", "field": "Economics", "year": 2012}
        ],
        "work_history": [
          {"company": "Stripe", "title": "Head of Partnerships", "start_year": 2018, "end_year": 2023, "description": "Built partnership program from 0 to $50M ARR"},
          {"company": "Google", "title": "Product Manager", "start_year": 2014, "end_year": 2016, "description": "Led Google Pay merchant integrations"}
        ],
        "impressive_thing": "Closed Stripe's largest enterprise partnership with a Fortune 100 retailer",
        "accolades": "Forbes 30 Under 30, Stanford GSB Arjay Miller Scholar"
      },
      {
        "name": "Marcus Johnson",
        "role": "CTO",
        "percent_equity": 40,
        "technical_founder": true,
        "in_school": false,
        "commit_exclusively": true,
        "age": 32,
        "gender": "Male",
        "city": "San Francisco",
        "education": [
          {"institution": "MIT", "degree": "MS", "field": "Computer Science", "year": 2014},
          {"institution": "Howard University", "degree": "BS", "field": "Computer Engineering", "year": 2012}
        ],
        "work_history": [
          {"company": "Meta", "title": "Staff Engineer", "start_year": 2019, "end_year": 2023, "description": "Tech lead for Instagram Reels recommendation system"},
          {"company": "Dropbox", "title": "Senior Engineer", "start_year": 2014, "end_year": 2019, "description": "Core infrastructure team"}
        ],
        "built_things": "Open source ML framework with 5k GitHub stars, side project that got 100k users",
        "hacked_system": "Reverse-engineered a competitor's API to build a migration tool that converted 10k users"
      },
      {
        "name": "Elena Rodriguez",
        "role": "CPO",
        "percent_equity": 15,
        "technical_founder": true,
        "in_school": false,
        "commit_exclusively": true,
        "age": 29,
        "gender": "Female",
        "city": "New York",
        "education": [
          {"institution": "Carnegie Mellon", "degree": "BS", "field": "Human-Computer Interaction", "year": 2016}
        ],
        "work_history": [
          {"company": "Figma", "title": "Senior Product Designer", "start_year": 2020, "end_year": 2023, "description": "Led design for FigJam collaboration features"},
          {"company": "IDEO", "title": "Product Designer", "start_year": 2016, "end_year": 2020, "description": "Design strategy for Fortune 500 clients"}
        ],
        "impressive_thing": "Designed the UX for a feature that increased Figma's enterprise retention by 40%"
      }
    ]
  ]
}
```

### Test 2: All-Technical Team (Missing commercial capability)
```json
{
  "items": [
    [
      {
        "name": "Alex Kumar",
        "role": "CEO",
        "percent_equity": 34,
        "technical_founder": true,
        "in_school": false,
        "commit_exclusively": true,
        "education": [{"institution": "Stanford", "degree": "PhD", "field": "Computer Science", "year": 2020}],
        "work_history": [{"company": "Google Brain", "title": "Research Scientist", "start_year": 2020, "end_year": 2023, "description": "ML research"}]
      },
      {
        "name": "Ben Lee",
        "role": "CTO",
        "percent_equity": 33,
        "technical_founder": true,
        "in_school": false,
        "commit_exclusively": true,
        "education": [{"institution": "Stanford", "degree": "MS", "field": "Computer Science", "year": 2018}],
        "work_history": [{"company": "Google", "title": "Senior Engineer", "start_year": 2018, "end_year": 2023, "description": "Backend systems"}]
      },
      {
        "name": "Chris Wang",
        "role": "Co-Founder",
        "percent_equity": 33,
        "technical_founder": true,
        "in_school": false,
        "commit_exclusively": true,
        "education": [{"institution": "Stanford", "degree": "MS", "field": "Computer Science", "year": 2019}],
        "work_history": [{"company": "Meta", "title": "Engineer", "start_year": 2019, "end_year": 2023, "description": "Infrastructure"}]
      }
    ]
  ]
}
```

### Test 3: Equity Misalignment (Part-time founder with high equity)
```json
{
  "items": [
    [
      {
        "name": "David Smith",
        "role": "CEO",
        "percent_equity": 30,
        "technical_founder": false,
        "in_school": false,
        "commit_exclusively": true,
        "work_history": [{"company": "Salesforce", "title": "Sales Director", "start_year": 2018, "end_year": 2023, "description": "Enterprise sales"}]
      },
      {
        "name": "Emily Brown",
        "role": "CTO",
        "percent_equity": 50,
        "technical_founder": true,
        "in_school": true,
        "commit_exclusively": false,
        "education": [{"institution": "MIT", "degree": "PhD", "field": "Computer Science", "year": 2025}]
      },
      {
        "name": "Frank Miller",
        "role": "COO",
        "percent_equity": 20,
        "technical_founder": false,
        "in_school": false,
        "commit_exclusively": true,
        "work_history": [{"company": "Amazon", "title": "Operations Manager", "start_year": 2019, "end_year": 2023, "description": "Warehouse operations"}]
      }
    ]
  ]
}
```

### Test 4: Solo Founder
```json
{
  "items": [
    [
      {
        "name": "Grace Kim",
        "role": "Founder",
        "percent_equity": 100,
        "technical_founder": true,
        "in_school": false,
        "commit_exclusively": true,
        "age": 28,
        "education": [
          {"institution": "Caltech", "degree": "BS", "field": "Computer Science", "year": 2018}
        ],
        "work_history": [
          {"company": "Apple", "title": "iOS Engineer", "start_year": 2018, "end_year": 2023, "description": "Core OS team"}
        ],
        "built_things": "Launched 3 indie iOS apps with 500k combined downloads"
      }
    ]
  ]
}
```

### Test 5: Large Team with Coordination Challenges
```json
{
  "items": [
    [
      {"name": "Founder 1", "role": "CEO", "percent_equity": 20, "technical_founder": false, "in_school": false, "commit_exclusively": true},
      {"name": "Founder 2", "role": "CTO", "percent_equity": 20, "technical_founder": true, "in_school": false, "commit_exclusively": true},
      {"name": "Founder 3", "role": "COO", "percent_equity": 20, "technical_founder": false, "in_school": false, "commit_exclusively": true},
      {"name": "Founder 4", "role": "CFO", "percent_equity": 20, "technical_founder": false, "in_school": false, "commit_exclusively": true},
      {"name": "Founder 5", "role": "CMO", "percent_equity": 10, "technical_founder": false, "in_school": false, "commit_exclusively": true},
      {"name": "Founder 6", "role": "CRO", "percent_equity": 10, "technical_founder": false, "in_school": false, "commit_exclusively": true}
    ]
  ]
}
```

### Test 6: Co-CEO Structure (Leadership ambiguity)
```json
{
  "items": [
    [
      {
        "name": "Hannah Lee",
        "role": "Co-CEO",
        "percent_equity": 50,
        "technical_founder": false,
        "in_school": false,
        "commit_exclusively": true,
        "work_history": [{"company": "McKinsey", "title": "Consultant", "start_year": 2019, "end_year": 2023, "description": "Strategy consulting"}]
      },
      {
        "name": "Ian Park",
        "role": "Co-CEO",
        "percent_equity": 50,
        "technical_founder": true,
        "in_school": false,
        "commit_exclusively": true,
        "education": [{"institution": "Stanford", "degree": "MS", "field": "Computer Science", "year": 2019}],
        "work_history": [{"company": "Google", "title": "Engineer", "start_year": 2019, "end_year": 2023, "description": "Search team"}]
      }
    ]
  ]
}
```

### Test 7: Student Founders
```json
{
  "items": [
    [
      {
        "name": "Jack Chen",
        "role": "CEO",
        "percent_equity": 50,
        "technical_founder": false,
        "in_school": true,
        "commit_exclusively": false,
        "age": 22,
        "education": [{"institution": "Harvard", "degree": "BA", "field": "Economics", "year": 2024}]
      },
      {
        "name": "Kate Williams",
        "role": "CTO",
        "percent_equity": 50,
        "technical_founder": true,
        "in_school": true,
        "commit_exclusively": false,
        "age": 21,
        "education": [{"institution": "MIT", "degree": "BS", "field": "Computer Science", "year": 2025}],
        "hacked_system": "Built a bot that automated class registration, sold access to 500 students"
      }
    ]
  ]
}
```

### Test 8: Minimal Data (Required fields only)
```json
{
  "items": [
    [
      {"name": "Person A", "role": "CEO", "percent_equity": 60, "technical_founder": false, "in_school": false, "commit_exclusively": true},
      {"name": "Person B", "role": "CTO", "percent_equity": 40, "technical_founder": true, "in_school": false, "commit_exclusively": true}
    ]
  ]
}
```

### Test 9: Comparative Ranking (Multiple teams)
```json
{
  "items": [
    [
      {"name": "Team 1 CEO", "role": "CEO", "percent_equity": 55, "technical_founder": false, "in_school": false, "commit_exclusively": true, "work_history": [{"company": "Google", "title": "Director", "start_year": 2015, "end_year": 2023, "description": "Product leadership"}]},
      {"name": "Team 1 CTO", "role": "CTO", "percent_equity": 45, "technical_founder": true, "in_school": false, "commit_exclusively": true, "built_things": "Led team that built Google Maps offline mode"}
    ],
    [
      {"name": "Team 2 Founder", "role": "Founder", "percent_equity": 100, "technical_founder": true, "in_school": true, "commit_exclusively": false}
    ],
    [
      {"name": "Team 3 A", "role": "Co-Founder", "percent_equity": 50, "technical_founder": true, "in_school": false, "commit_exclusively": true},
      {"name": "Team 3 B", "role": "Co-Founder", "percent_equity": 50, "technical_founder": true, "in_school": false, "commit_exclusively": true}
    ]
  ]
}
```

### Test 10: Exceptionally Strong Signals
```json
{
  "items": [
    [
      {
        "name": "Lisa Zhang",
        "role": "CEO",
        "percent_equity": 50,
        "technical_founder": true,
        "in_school": false,
        "commit_exclusively": true,
        "age": 35,
        "education": [{"institution": "Stanford", "degree": "PhD", "field": "Machine Learning", "year": 2015}],
        "work_history": [
          {"company": "OpenAI", "title": "Research Director", "start_year": 2018, "end_year": 2023, "description": "Led GPT-4 safety research"},
          {"company": "DeepMind", "title": "Research Scientist", "start_year": 2015, "end_year": 2018, "description": "AlphaGo team member"}
        ],
        "impressive_thing": "Co-authored the RLHF paper that enabled ChatGPT",
        "accolades": "NeurIPS Best Paper Award, MIT TR35",
        "hacked_system": "Built an automated trading system in college that made $100k",
        "built_things": "Two previous startups, one acquired by Meta for $50M"
      },
      {
        "name": "Mike Robinson",
        "role": "COO",
        "percent_equity": 50,
        "technical_founder": false,
        "in_school": false,
        "commit_exclusively": true,
        "age": 38,
        "education": [{"institution": "Harvard Business School", "degree": "MBA", "field": "General Management", "year": 2012}],
        "work_history": [
          {"company": "Stripe", "title": "VP Operations", "start_year": 2016, "end_year": 2023, "description": "Built operations from 200 to 8000 employees"},
          {"company": "LinkedIn", "title": "Director of Operations", "start_year": 2012, "end_year": 2016, "description": "International expansion"}
        ],
        "impressive_thing": "Orchestrated Stripe's expansion into 15 new countries in 18 months",
        "accolades": "Fortune 40 Under 40"
      }
    ]
  ]
}
```

---

## Edge Cases Covered

1. **Ideal team** - Baseline for strong team dynamics
2. **All-technical team** - Missing commercial capability
3. **Equity-commitment mismatch** - Part-timer with highest equity
4. **Solo founder** - Single-person team
5. **Large team** - Too many founders (6)
6. **Co-CEO structure** - Leadership ambiguity
7. **Student founders** - Not committing exclusively, in school
8. **Minimal data** - Only required fields
9. **Comparative ranking** - Multiple teams of varying quality
10. **Exceptional signals** - Strong hacked_system, impressive_thing, accolades

---

## Implementation Notes

### Starlark Expression Complexity

The user content expression for formatting founder data is complex. Consider breaking it into a helper approach or using a simpler formatting strategy. The key is ensuring all optional fields are handled gracefully with `.get()` or conditional inclusion.

### Response Ordering

All tasks use LOW as response[0] and HIGH as response[1]. The output expression extracts `scores[1]` (HIGH scores) for normalization, meaning teams assessed as HIGH get higher probability mass.

### Normalization

The output expression `(lambda scores: [s / sum(scores) if sum(scores) > 0 else 1.0 / len(scores) for s in scores])([o['scores'][1] for o in output])` ensures:
- Scores sum to 1.0 (probability distribution)
- Handles edge case where all scores are 0 (uniform distribution)
- Higher HIGH scores = higher ranking

### Task Independence

Each task evaluates one dimension independently. The final output is the aggregation across all tasks, allowing multidimensional ranking where different teams may excel on different dimensions.